/*
 * Midnight Theme Override for Signal Desktop
 * ------------------------------------------
 * Transforms Signal's conversation view to resemble Midnight's midnight theme.
 * All spacing values taken directly from Midnight's CSS (group-spacing-16, cozy mode).
 * Only CSS overrides + minimal TSX changes (avatar/author always visible).
 */

/* ==========================================================================
   @font-face — Midnight "sd sans" font family
   ========================================================================== */
}
}
}
}
}
}
}
}
}
}

/* ==========================================================================
   CSS Custom Properties — Midnight Midnight visual-refresh palette + layout tokens
   Source: canary.midnight.com theme-midnight with visual-refresh
   ========================================================================== */
:root {
  /* Backgrounds — Midnight Midnight visual-refresh tokens */
  --midnight-bg-primary: #000000;              /* --background-base-lowest (neutral-100) */
  --midnight-bg-chat: #0c0c0e;                 /* --background-base-low (neutral-95) — main chat area */
  --midnight-bg-secondary: #131416;            /* --background-surface-high (neutral-91) */
  --midnight-bg-tertiary: #000000;             /* --background-base-lowest (neutral-100) */
  --midnight-bg-surface-highest: #1e1f22;      /* --background-surface-highest (neutral-83) */
  --midnight-bg-hover: rgba(255, 255, 255, 0.122); /* --message-background-hover / --background-mod-subtle */

  /* Text — Midnight Midnight visual-refresh tokens */
  --midnight-text-normal: #dcdcdf;             /* --text-default (neutral-10) */
  --midnight-text-strong: #e4e4e6;             /* --text-strong (neutral-8) */
  --midnight-text-subtle: #9d9ea5;             /* --text-subtle (neutral-27) */
  --midnight-text-muted: #888991;              /* --text-muted (neutral-33) */
  --midnight-text-link: #3789ea;               /* --text-link (blue-new-42) */
  --midnight-chat-text-muted: #767780;         /* --chat-text-muted (neutral-38) */
  --midnight-header-primary: #e4e4e6;          /* --text-strong (neutral-8) — username color, oklab(0.919362 0.000797629 -0.00255835) */
  --midnight-font: "sd sans", "Noto Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;

  /* Layout tokens — from Midnight CSS variables */
  --midnight-avatar-size: 40px;                /* --custom-message-avatar-size */
  --midnight-gutter: 16px;                     /* --custom-message-margin-horizontal */
  --midnight-message-indent: 4.5rem;           /* 72px = avatar + 2*gutter */
  --midnight-msg-vertical-pad: 0.125rem;       /* 2px */
  --midnight-group-spacing: 1.0625rem;         /* 17px (group-spacing-16) */
  --midnight-group-start-min-height: 2.75rem;  /* 44px */
  --midnight-meta-space: 0.25rem;              /* 4px */

  /* Misc — Midnight Midnight visual-refresh */
  --midnight-input-bg: #1e1f22;                /* --background-surface-highest (neutral-83) */
  --midnight-reaction-bg: #1e1f22;             /* --background-surface-highest (neutral-83) */
  --midnight-divider: #3b3c43;                 /* --spine-default (neutral-63) */
  --midnight-border-subtle: rgba(255, 255, 255, 0.200); /* --border-subtle */
  --midnight-scrollbar-thumb: #595a63;         /* --scrollbar-thin-thumb (neutral-47) */
  --midnight-input-placeholder: #73747d;       /* --input-placeholder-text (neutral-39) */
  --midnight-channels-default: #7a7b83;        /* --channels-default (neutral-37) */

  /* Override Signal's own font variable so everything picks up sd sans */
  --font-sans: "sd sans", "Noto Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
}

/* ==========================================================================
   Global font — override Signal's --font-sans + body font.
   Excludes SignalSymbols icon font (.font-symbols) so icons render correctly.
   ========================================================================== */
body.dark-theme,
body.dark-theme *:not(.font-symbols) {
  font-family: var(--midnight-font) !important;
}

/* ==========================================================================
   Background colors
   ========================================================================== */
.dark-theme .ConversationView__pane,
.dark-theme .conversation {
  background-color: var(--midnight-bg-primary) !important; /* #000000 — user preference */
}

.dark-theme .module-ConversationHeader {
  background-color: var(--midnight-bg-secondary) !important;
  border-bottom: 1px solid var(--midnight-bg-tertiary) !important;
  box-shadow: none !important;
}

.dark-theme .NavSidebar {
  background-color: var(--midnight-bg-secondary) !important;
}

.dark-theme .NavTabs {
  background-color: var(--midnight-bg-tertiary) !important;
}

.dark-theme .ConversationView__composition-area {
  background-color: var(--midnight-bg-primary) !important;
}

/* ==========================================================================
   Message row — exact Midnight cozy layout
   Midnight: padding 2px top/bottom, 48px left (content indent), 48px right.
   Avatar is position:absolute at left:16px.
   We use flex with avatar container instead, same visual result.
   ========================================================================== */
.dark-theme .module-message {
  padding-inline: 0 !important;
  padding-left: var(--midnight-gutter) !important;    /* 16px */
  padding-right: var(--midnight-gutter) !important;   /* 16px — same as Midnight */
  padding-top: var(--midnight-msg-vertical-pad) !important;    /* 2px */
  padding-bottom: var(--midnight-msg-vertical-pad) !important; /* 2px */
  border-radius: 0 !important;
  align-items: flex-start !important;
  position: relative !important;
  /* Consistent line height for all message rows */
  line-height: 1.375rem !important; /* 22px — Midnight baseline */
}

/* Midnight: hover highlights entire message row */
.dark-theme .module-message:hover {
  background-color: var(--midnight-bg-hover) !important;
}

/* Force outgoing messages to left-align (same as incoming) */
.dark-theme .module-message--outgoing {
  flex-direction: row !important;
}

/* Group-start messages (avatar + author shown): Midnight 17px top margin */
.dark-theme .module-message:not(.module-message--collapsed-above) {
  margin-top: var(--midnight-group-spacing) !important;
}

/* Continuation messages: no extra top margin, zero spacing */
.dark-theme .module-message--collapsed-above {
  margin-top: 0 !important;
}

/* ==========================================================================
   Message bubble — REMOVED (transparent, no padding/margin/radius)
   ========================================================================== */
.dark-theme .module-message__container,
.dark-theme .module-message__container--incoming,
.dark-theme .module-message__container--outgoing,
.dark-theme [class*="module-message__container--outgoing-"] {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  border-radius: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  overflow: visible !important;
  color: var(--midnight-text-normal) !important;
  /* static so metadata can position absolute to .module-message row */
  position: static !important;
}

.dark-theme .module-message__container-outer {
  max-width: 100% !important;
  line-height: 1.375rem !important; /* 22px — Midnight consistent line height */
}

/* Kill all container margin/padding for collapsed messages (Signal adds 1px) */
.dark-theme .module-message--collapsed-above .module-message__container,
.dark-theme .module-message--collapsed-below .module-message__container {
  margin: 0 !important;
  padding: 0 !important;
}

/* ==========================================================================
   Avatar — 40px, top-aligned, flex-based (mirrors Midnight absolute positioning)
   Midnight: position:absolute, left:16px, margin-top:2px
   We get equivalent via flex: [16px pad][40px avatar][16px gap][content]
   ========================================================================== */
.dark-theme .module-message__author-avatar-container {
  min-width: var(--midnight-avatar-size) !important;
  width: var(--midnight-avatar-size) !important;
  margin-inline-end: var(--midnight-gutter) !important; /* 16px gap */
  padding-bottom: 0 !important;
  padding-top: 2px !important;  /* Midnight: margin-top: calc(4px - 2px) = 2px */
  align-items: flex-start !important;
  flex-shrink: 0 !important;
}

.dark-theme .module-message__author-avatar-container .module-Avatar,
.dark-theme .module-message__author-avatar-container .module-Avatar__contents {
  width: var(--midnight-avatar-size) !important;
  height: var(--midnight-avatar-size) !important;
  min-width: var(--midnight-avatar-size) !important;
  border-radius: 50% !important;
}

/* ==========================================================================
   Author name — Midnight: font-weight 600 (semibold), 16px, inline
   ========================================================================== */
.dark-theme .module-message__author {
  color: var(--midnight-header-primary) !important;
  font-weight: 500 !important;  /* Midnight: --font-weight-medium */
  font-size: 1rem !important;   /* 16px */
  line-height: 1.375rem !important; /* 22px */
  margin-bottom: 0 !important;
  display: inline !important;
  overflow: visible !important;
}

.dark-theme .module-message__author_with_sticker {
  color: var(--midnight-header-primary) !important;
  font-weight: 500 !important;
}

/* ==========================================================================
   Inline header timestamp — "Username  HH:MM" on group-start
   Always visible. Small spacing between name and time, no dash.
   Midnight: font-size 12px, line-height 22px, muted color, font-weight 500.
   ========================================================================== */
.dark-theme .module-message__header-timestamp {
  display: inline !important;
  margin-inline-start: 0.25rem !important; /* 4px spacing after username */
  font-size: 0.75rem !important;           /* 12px */
  line-height: 1.375rem !important;        /* 22px */
  color: var(--midnight-text-muted) !important;
  font-weight: 500 !important;
  vertical-align: baseline !important;
}

.dark-theme .module-message__header-timestamp time {
  display: inline !important;
  color: var(--midnight-text-muted) !important;
  font-size: 0.75rem !important;
  font-weight: 500 !important;
}

/* ==========================================================================
   Gutter timestamp — Midnight: shown ONLY on hover for continuation messages
   Midnight: width 56px (16px gutter + 40px avatar), text-align:end, position:absolute.
   We offset left by -16px from the avatar container to span the full gutter.
   ========================================================================== */
.dark-theme .module-message__gutter-timestamp {
  position: absolute !important;
  top: 0 !important;
  left: calc(-1 * var(--midnight-gutter)) !important;  /* -16px: start at row edge */
  width: 56px !important;                              /* 16px + 40px = full gutter */
  height: 1.375rem !important;                         /* 22px — one line */
  display: flex !important;
  align-items: center !important;
  justify-content: flex-end !important;                /* text-align: end */
  opacity: 0 !important;
  transition: opacity 0.1s ease-out !important;
  pointer-events: none !important;
  z-index: 1 !important;
}

.dark-theme .module-message__gutter-timestamp time {
  font-size: 0.6875rem !important;      /* 11px — Midnight compact */
  line-height: 1.375rem !important;
  color: var(--midnight-chat-text-muted) !important; /* #767780 (neutral-38) */
  font-weight: 500 !important;
  margin-inline-end: 0.25rem !important; /* Midnight: --custom-message-meta-space */
}

/* Show gutter timestamp ONLY on message row hover */
.dark-theme .module-message:hover .module-message__gutter-timestamp {
  opacity: 1 !important;
}

/* Avatar spacer in continuation messages: keep width for alignment, zero height.
   The AvatarSpacer is a div with inline style height:40 — override with !important.
   position:relative needed for the absolute gutter timestamp. */
.dark-theme .module-message--collapsed-above .module-message__author-avatar-container {
  position: relative !important;
  height: auto !important;
  align-self: stretch !important;
}
.dark-theme .module-message--collapsed-above .module-message__author-avatar-container > div:not(.module-message__gutter-timestamp) {
  height: 0 !important;
  min-height: 0 !important;
  overflow: hidden !important;
}

/* ==========================================================================
   Text content — Midnight: 16px, line-height 22px, zero extra spacing
   ========================================================================== */
.dark-theme .module-message__text,
.dark-theme .module-message__text--incoming,
.dark-theme .module-message__text--outgoing {
  color: var(--midnight-text-normal) !important;
  font-size: 1rem !important;           /* 16px */
  line-height: 1.375rem !important;     /* 22px */
  letter-spacing: normal !important;
  margin: 0 !important;
  padding: 0 !important;
}

.dark-theme .module-message__text a,
.dark-theme .module-message__text--incoming a,
.dark-theme .module-message__text--outgoing a {
  color: var(--midnight-text-link) !important;
}

/* ==========================================================================
   Bottom metadata — hover-only, absolute right, aligned with last text line.
   Anchored to .module-message (position:relative) since container is static.
   Same right offset as action buttons (14px).
   ========================================================================== */
.dark-theme .module-message__metadata {
  position: absolute !important;
  right: 14px !important;
  bottom: var(--midnight-msg-vertical-pad) !important; /* 2px — match row padding */
  color: var(--midnight-text-muted) !important;
  font-size: 0.75rem !important;
  line-height: 1.375rem !important;
  margin-top: 0 !important;
  justify-content: flex-end !important;
  opacity: 0 !important;
  transition: opacity 0.1s ease-out !important;
  z-index: 1 !important;
}

.dark-theme .module-message:hover .module-message__metadata {
  opacity: 1 !important;
}

/* Override inline variant — no float/margin needed, absolute handles it */
.dark-theme .module-message__metadata--inline {
  float: none !important;
  margin-top: 0 !important;
}

.dark-theme .module-message__metadata--outgoing {
  color: var(--midnight-text-muted) !important;
}

/* Hide timestamp from bottom metadata — already shown in header/gutter */
.dark-theme .module-message__metadata__date {
  display: none !important;
}

.dark-theme .module-message__metadata__status-icon {
  opacity: 0.6 !important;
}

.dark-theme .module-message__metadata__edited {
  color: var(--midnight-text-muted) !important;
}

/* ==========================================================================
   Date header — Midnight-style horizontal line with centered label
   Midnight: border-top thin solid, text centered on the line,
   margin-top 1.5rem (24px), margin-bottom 0.5rem (8px) for group-spacing-16.
   Font: 12px, semibold (600), muted color, border-radius 8px, padding 2px 4px.
   ========================================================================== */
.dark-theme .TimelineDateHeader {
  color: var(--midnight-text-muted) !important;
  font-size: 0.75rem !important;  /* 12px */
  font-weight: 600 !important;    /* semibold */
  line-height: 0.8125rem !important; /* 13px */
}

.dark-theme .TimelineDateHeader--inline {
  padding: 0 !important;
  margin-top: 1.5rem !important;   /* 24px — Midnight divider top margin */
  margin-bottom: 0.5rem !important; /* 8px — Midnight divider bottom margin (group-spacing-16) */
  margin-inline: 1rem 0.875rem !important; /* 16px / 14px — Midnight divider margins */
  position: relative !important;
  display: flex !important;
  align-items: center !important;
  text-align: center !important;
}

/* Horizontal line through the date header (Midnight-style) */
.dark-theme .TimelineDateHeader--inline::before,
.dark-theme .TimelineDateHeader--inline::after {
  content: "" !important;
  flex: 1 !important;
  border-bottom: 1px solid var(--midnight-divider) !important;
}

.dark-theme .TimelineDateHeader--inline::before {
  margin-right: 0.5rem !important;
}

.dark-theme .TimelineDateHeader--inline::after {
  margin-left: 0.5rem !important;
}

/* Floating date header (sticky at top) */
.dark-theme .TimelineDateHeader--floating {
  background-color: var(--midnight-bg-primary) !important;
  border: 1px solid var(--midnight-divider) !important;
  border-radius: 8px !important;
  padding: 2px 8px !important;
}

.dark-theme .TimelineFloatingHeader {
  z-index: 3 !important;
}

/* ==========================================================================
   Emoji-only & sticker messages
   ========================================================================== */
.dark-theme .module-message__container--emoji,
.dark-theme .module-message__container--sticker-like {
  background: transparent !important;
  padding: 0 !important;
}

/* ==========================================================================
   Reactions — Midnight pills
   ========================================================================== */
.dark-theme .module-message__reactions {
  padding-top: 4px !important;
}

.dark-theme .module-message__reactions--outgoing {
  align-self: flex-start !important;
  padding-inline-start: 0 !important;
  margin-inline-end: 0 !important;
}

.dark-theme .module-message__reactions__reaction {
  background: var(--midnight-reaction-bg) !important;
  border-color: var(--midnight-reaction-bg) !important;
}

.dark-theme .module-message__reactions__reaction--is-me {
  border-color: rgba(88, 101, 242, 0.6) !important;
  background: rgba(88, 101, 242, 0.15) !important;
}

/* ==========================================================================
   Action buttons — Midnight floating toolbar
   ========================================================================== */
.dark-theme .module-message__buttons {
  position: absolute !important;
  right: 14px !important;
  top: -16px !important;
  background: var(--midnight-bg-secondary) !important;
  border-radius: 4px !important;
  padding: 2px 4px !important;
  border: 1px solid var(--midnight-border-subtle) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
  z-index: 2 !important;
}

.dark-theme .module-message__buttons--incoming,
.dark-theme .module-message__buttons--outgoing {
  padding-inline: 4px !important;
  flex-direction: row !important;
}

/* ==========================================================================
   Composition area — Midnight input bar
   ========================================================================== */
.dark-theme .CompositionArea {
  background-color: var(--midnight-bg-primary) !important; /* match chat area */
  padding-inline: var(--midnight-gutter) !important;
}

.dark-theme .module-composition-input__input {
  background-color: var(--midnight-input-bg) !important;
  border-radius: 8px !important;
  color: var(--midnight-text-normal) !important;
}

.dark-theme .module-composition-input__input .ql-blank::before {
  color: var(--midnight-input-placeholder) !important; /* #73747d (neutral-39) */
}

.dark-theme .CompositionArea__button-cell {
  color: var(--midnight-text-muted) !important;
}

.dark-theme .CompositionArea__attach-file:before {
  background-color: var(--midnight-text-muted) !important;
}

.dark-theme .CompositionArea__send-button::after {
  background-color: var(--midnight-text-normal) !important;
}

/* ==========================================================================
   Quotes / Replies — Midnight-style
   Midnight reply: 14px font, 18px line-height, 4px bottom margin,
   2px spine width, 6px spine border-radius
   ========================================================================== */
.dark-theme .module-quote {
  border-radius: 4px !important;
  font-size: 0.875rem !important;  /* 14px */
}

.dark-theme .module-quote--incoming,
.dark-theme .module-quote--outgoing {
  background-color: rgba(255, 255, 255, 0.122) !important; /* --background-mod-subtle */
}

/* ==========================================================================
   Link previews — Midnight embed style
   ========================================================================== */
.dark-theme .module-message__link-preview {
  background-color: var(--midnight-bg-secondary) !important; /* #131416 (neutral-91) */
  border: 1px solid var(--midnight-border-subtle) !important;
  border-radius: 8px !important;
  overflow: hidden !important;
}

/* ==========================================================================
   Image attachments — Midnight-style: rounded corners, proper spacing
   ========================================================================== */
.dark-theme .module-message__attachment-container {
  margin-top: 4px !important;
  margin-bottom: 4px !important;
  margin-inline: 0 !important;
  text-align: start !important;
  background-color: transparent !important;
  border-radius: 8px !important;
  overflow: hidden !important;
}

.dark-theme .module-message__img-attachment {
  border-radius: 8px !important;
  margin-bottom: 0 !important;  /* Signal adds -3px */
}

.dark-theme .module-image-grid {
  border-radius: 8px !important;
  overflow: hidden !important;
}

/* Remove Signal's inset box-shadow border on images */
.dark-theme .module-image__border-overlay,
.dark-theme .module-image__border-overlay--with-border {
  box-shadow: none !important;
}

/* Image metadata overlay (no-caption images) — remove Signal's absolute bottom overlay */
.dark-theme .module-message__metadata--with-image-no-caption {
  position: absolute !important;
  bottom: 2px !important;
  right: 14px !important;
}

.dark-theme .module-message__simple-attachment {
  background-color: var(--midnight-bg-secondary) !important;
  border-radius: 8px !important;
  border: 1px solid var(--midnight-border-subtle) !important;
}

.dark-theme .module-message__simple-attachment__file-name,
.dark-theme .module-message__simple-attachment__file-name--incoming {
  color: var(--midnight-text-link) !important;
}

.dark-theme .module-message__simple-attachment__file-size,
.dark-theme .module-message__simple-attachment__file-size--incoming {
  color: var(--midnight-text-muted) !important;
}

/* ==========================================================================
   Scrollbar — Midnight thin dark
   ========================================================================== */
.dark-theme .ConversationView__timeline::-webkit-scrollbar {
  width: 8px !important;
}
.dark-theme .ConversationView__timeline::-webkit-scrollbar-track {
  background: transparent !important;
}
.dark-theme .ConversationView__timeline::-webkit-scrollbar-thumb {
  background-color: var(--midnight-scrollbar-thumb) !important; /* #595a63 (neutral-47) */
  border-radius: 4px !important;
}
.dark-theme .ConversationView__timeline::-webkit-scrollbar-thumb:hover {
  background-color: #7a7b83 !important; /* slightly lighter on hover */
}

/* ==========================================================================
   Deleted messages
   ========================================================================== */
.dark-theme .module-message__container--deleted-for-everyone {
  background-color: transparent !important;
  border: none !important;
}
.dark-theme .module-message__text--delete-for-everyone {
  color: var(--midnight-text-muted) !important;
  font-style: italic !important;
}

/* ==========================================================================
   Selection / focus / targeted states — disable click-to-highlight
   ========================================================================== */
.dark-theme .module-message__container--targeted,
.dark-theme .module-message__container--targeted-lighter {
  animation: none !important;
}

.dark-theme .module-message__wrapper--selected {
  background: transparent !important;
}

/* ==========================================================================
   Typing indicator
   ========================================================================== */
.dark-theme .module-message__container-outer--typing-bubble {
  background: transparent !important;
}

/* ==========================================================================
   Error container
   ========================================================================== */
.dark-theme .module-message__error-container {
  min-width: 20px !important;
}

/* ==========================================================================
   Conversation list (left sidebar)
   ========================================================================== */
.dark-theme .module-conversation-list {
  background-color: var(--midnight-bg-secondary) !important;
}

/* ==========================================================================
   Conversation header
   ========================================================================== */
.dark-theme .module-ConversationHeader__button::before {
  background-color: var(--midnight-channels-default) !important; /* #7a7b83 (neutral-37) */
}
.dark-theme .module-ConversationHeader__button:hover::before {
  background-color: var(--midnight-text-strong) !important; /* #e4e4e6 on hover */
}

.dark-theme .module-ConversationHeader__header__info__title {
  color: var(--midnight-text-strong) !important; /* #e4e4e6 — header text */
}
.dark-theme .module-ConversationHeader__header__info__subtitle {
  color: var(--midnight-text-muted) !important;
}

/* ==========================================================================
   System messages
   ========================================================================== */
.dark-theme .SystemMessage {
  color: var(--midnight-text-muted) !important;
}
