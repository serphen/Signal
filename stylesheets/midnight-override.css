/*
 * Midnight Theme Override for Signal Desktop
 * ------------------------------------------
 * Transforms Signal's conversation view to resemble Midnight's midnight theme.
 * All spacing values taken directly from Midnight's CSS (group-spacing-16, cozy mode).
 * Only CSS overrides + minimal TSX changes (avatar/author always visible).
 */

/* ==========================================================================
   @font-face — Midnight "sd sans" font family
   ========================================================================== */
}
}
}
}
}
}
}
}
}
}

/* ==========================================================================
   CSS Custom Properties — Midnight Midnight palette + exact layout tokens
   ========================================================================== */
:root {
  --midnight-bg-primary: #111214;
  --midnight-bg-secondary: #1e1f22;
  --midnight-bg-tertiary: #0b0d0e;
  --midnight-bg-hover: rgba(255, 255, 255, 0.06);
  --midnight-text-normal: #dbdee1;
  --midnight-text-muted: #949ba4;
  --midnight-text-link: #00a8fc;
  --midnight-header-primary: #f2f3f5;
  --midnight-font: "sd sans", "Noto Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;

  /* Layout tokens — from Midnight CSS variables */
  --midnight-avatar-size: 40px;                /* --custom-message-avatar-size */
  --midnight-gutter: 16px;                     /* --custom-message-margin-horizontal */
  --midnight-message-indent: 4.5rem;           /* 72px = avatar + 2*gutter */
  --midnight-msg-vertical-pad: 0.125rem;       /* 2px */
  --midnight-group-spacing: 1.0625rem;         /* 17px (group-spacing-16) */
  --midnight-group-start-min-height: 2.75rem;  /* 44px */
  --midnight-meta-space: 0.25rem;              /* 4px */

  /* Misc */
  --midnight-input-bg: #383a40;
  --midnight-reaction-bg: #2b2d31;
  --midnight-divider: #3f4147;
  --midnight-border-subtle: rgba(255, 255, 255, 0.06);
}

/* ==========================================================================
   Global font
   ========================================================================== */
body.dark-theme,
body.dark-theme * {
  font-family: var(--midnight-font) !important;
}

/* ==========================================================================
   Background colors
   ========================================================================== */
.dark-theme .ConversationView__pane,
.dark-theme .conversation {
  background-color: var(--midnight-bg-primary) !important;
}

.dark-theme .module-ConversationHeader {
  background-color: var(--midnight-bg-secondary) !important;
  border-bottom: 1px solid var(--midnight-bg-tertiary) !important;
  box-shadow: none !important;
}

.dark-theme .NavSidebar {
  background-color: var(--midnight-bg-secondary) !important;
}

.dark-theme .NavTabs {
  background-color: var(--midnight-bg-tertiary) !important;
}

.dark-theme .ConversationView__composition-area {
  background-color: var(--midnight-bg-primary) !important;
}

/* ==========================================================================
   Message row — exact Midnight cozy layout
   Midnight: padding 2px top/bottom, 72px left (content indent), 16px right.
   Avatar is position:absolute at left:16px.
   We use flex with avatar container instead, same visual result.
   ========================================================================== */
.dark-theme .module-message {
  padding-inline: 0 !important;
  padding-left: var(--midnight-gutter) !important;    /* 16px */
  padding-right: var(--midnight-gutter) !important;   /* 16px — Midnight uses 16px */
  padding-top: var(--midnight-msg-vertical-pad) !important;    /* 2px */
  padding-bottom: var(--midnight-msg-vertical-pad) !important; /* 2px */
  border-radius: 0 !important;
  align-items: flex-start !important;
  position: relative !important;
}

/* Midnight: hover highlights entire message row */
.dark-theme .module-message:hover {
  background-color: var(--midnight-bg-hover) !important;
}

/* Force outgoing messages to left-align (same as incoming) */
.dark-theme .module-message--outgoing {
  flex-direction: row !important;
}

/* Group-start messages (avatar + author shown): Midnight 17px top margin */
.dark-theme .module-message:not(.module-message--collapsed-above) {
  margin-top: var(--midnight-group-spacing) !important;
  min-height: var(--midnight-group-start-min-height) !important; /* 44px min */
}

/* Continuation messages: no extra top margin, consistent tight spacing */
.dark-theme .module-message--collapsed-above {
  margin-top: 0 !important;
  min-height: 1.375rem !important; /* 22px */
}

/* ==========================================================================
   Message bubble — REMOVED (transparent, no padding/margin/radius)
   ========================================================================== */
.dark-theme .module-message__container,
.dark-theme .module-message__container--incoming,
.dark-theme .module-message__container--outgoing,
.dark-theme [class*="module-message__container--outgoing-"] {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  border-radius: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  overflow: visible !important;
  color: var(--midnight-text-normal) !important;
}

.dark-theme .module-message__container-outer {
  max-width: 100% !important;
  line-height: normal !important;
}

/* ==========================================================================
   Avatar — 40px, top-aligned, flex-based (mirrors Midnight absolute positioning)
   Midnight: position:absolute, left:16px, margin-top:2px
   We get equivalent via flex: [16px pad][40px avatar][16px gap][content]
   ========================================================================== */
.dark-theme .module-message__author-avatar-container {
  min-width: var(--midnight-avatar-size) !important;
  width: var(--midnight-avatar-size) !important;
  margin-inline-end: var(--midnight-gutter) !important; /* 16px gap */
  padding-bottom: 0 !important;
  padding-top: 2px !important;  /* Midnight: margin-top: calc(4px - 2px) = 2px */
  align-items: flex-start !important;
  flex-shrink: 0 !important;
}

.dark-theme .module-message__author-avatar-container .module-Avatar,
.dark-theme .module-message__author-avatar-container .module-Avatar__contents {
  width: var(--midnight-avatar-size) !important;
  height: var(--midnight-avatar-size) !important;
  min-width: var(--midnight-avatar-size) !important;
  border-radius: 50% !important;
}

/* ==========================================================================
   Author name — Midnight: font-weight 600 (semibold), 16px, inline
   ========================================================================== */
.dark-theme .module-message__author {
  color: var(--midnight-header-primary) !important;
  font-weight: 600 !important;  /* Midnight uses semibold (600) */
  font-size: 1rem !important;   /* 16px */
  line-height: 1.375rem !important; /* 22px */
  margin-bottom: 0 !important;
  display: inline !important;
  overflow: visible !important;
}

.dark-theme .module-message__author_with_sticker {
  color: var(--midnight-header-primary) !important;
  font-weight: 600 !important;
}

/* ==========================================================================
   Inline header timestamp — "Username  HH:MM" on group-start
   Always visible. Small spacing between name and time, no dash.
   Midnight: font-size 12px, line-height 22px, muted color, font-weight 500.
   ========================================================================== */
.dark-theme .module-message__header-timestamp {
  display: inline !important;
  margin-inline-start: 0.25rem !important; /* 4px spacing after username */
  font-size: 0.75rem !important;           /* 12px */
  line-height: 1.375rem !important;        /* 22px */
  color: var(--midnight-text-muted) !important;
  font-weight: 500 !important;
  vertical-align: baseline !important;
}

.dark-theme .module-message__header-timestamp time {
  display: inline !important;
  color: var(--midnight-text-muted) !important;
  font-size: 0.75rem !important;
  font-weight: 500 !important;
}

/* ==========================================================================
   Gutter timestamp — Midnight: shown ONLY on hover for continuation messages
   Positioned over the avatar spacer area, hidden by default.
   Midnight uses compact time (e.g. "15:31") centered in the 40px gutter.
   ========================================================================== */
.dark-theme .module-message__gutter-timestamp {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: var(--midnight-avatar-size) !important;  /* 40px */
  height: 1.375rem !important;                    /* 22px — one line */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  opacity: 0 !important;
  transition: opacity 0.1s ease-out !important;
  pointer-events: none !important;
  z-index: 1 !important;
}

.dark-theme .module-message__gutter-timestamp time {
  font-size: 0.6875rem !important;      /* 11px — Midnight compact */
  line-height: 1.375rem !important;
  color: var(--midnight-text-muted) !important;
  font-weight: 500 !important;
}

/* Show gutter timestamp ONLY on message row hover */
.dark-theme .module-message:hover .module-message__gutter-timestamp {
  opacity: 1 !important;
}

/* Avatar spacer needs relative positioning for the gutter timestamp */
.dark-theme .module-message--collapsed-above .module-message__author-avatar-container {
  position: relative !important;
}

/* ==========================================================================
   Text content — Midnight: 16px, line-height 22px
   ========================================================================== */
.dark-theme .module-message__text,
.dark-theme .module-message__text--incoming,
.dark-theme .module-message__text--outgoing {
  color: var(--midnight-text-normal) !important;
  font-size: 1rem !important;
  line-height: 1.375rem !important;
}

.dark-theme .module-message__text a,
.dark-theme .module-message__text--incoming a,
.dark-theme .module-message__text--outgoing a {
  color: var(--midnight-text-link) !important;
}

/* ==========================================================================
   Bottom metadata — hover-only, inline at the end of content.
   ========================================================================== */
.dark-theme .module-message__metadata {
  color: var(--midnight-text-muted) !important;
  font-size: 0.75rem !important;
  line-height: 1.375rem !important;
  margin-top: 0 !important;
  justify-content: flex-start !important;
  opacity: 0 !important;
  transition: opacity 0.1s ease-out !important;
}

.dark-theme .module-message:hover .module-message__metadata {
  opacity: 1 !important;
}

.dark-theme .module-message__metadata--inline {
  float: none !important;
  margin-top: 0 !important;
}

.dark-theme .module-message__metadata--outgoing {
  color: var(--midnight-text-muted) !important;
}

/* Hide timestamp from bottom metadata — already shown in header/gutter */
.dark-theme .module-message__metadata__date {
  display: none !important;
}

.dark-theme .module-message__metadata__status-icon {
  opacity: 0.6 !important;
}

.dark-theme .module-message__metadata__edited {
  color: var(--midnight-text-muted) !important;
}

/* Inline metadata — same absolute positioning */
.dark-theme .module-message__metadata--inline {
  margin-top: 0 !important;
  float: none !important;
}

/* ==========================================================================
   Date header — Midnight-style horizontal line with centered label
   Midnight: border-top thin solid, text centered on the line,
   margin-top 1.5rem (24px), margin-bottom 0.5rem (8px) for group-spacing-16.
   Font: 12px, semibold (600), muted color, border-radius 8px, padding 2px 4px.
   ========================================================================== */
.dark-theme .TimelineDateHeader {
  color: var(--midnight-text-muted) !important;
  font-size: 0.75rem !important;  /* 12px */
  font-weight: 600 !important;    /* semibold */
  line-height: 0.8125rem !important; /* 13px */
}

.dark-theme .TimelineDateHeader--inline {
  padding: 0 !important;
  margin-top: 1.5rem !important;   /* 24px — Midnight divider top margin */
  margin-bottom: 0.5rem !important; /* 8px — Midnight divider bottom margin (group-spacing-16) */
  margin-inline: 1rem 0.875rem !important; /* 16px / 14px — Midnight divider margins */
  position: relative !important;
  display: flex !important;
  align-items: center !important;
  text-align: center !important;
}

/* Horizontal line through the date header (Midnight-style) */
.dark-theme .TimelineDateHeader--inline::before,
.dark-theme .TimelineDateHeader--inline::after {
  content: "" !important;
  flex: 1 !important;
  border-bottom: 1px solid var(--midnight-divider) !important;
}

.dark-theme .TimelineDateHeader--inline::before {
  margin-right: 0.5rem !important;
}

.dark-theme .TimelineDateHeader--inline::after {
  margin-left: 0.5rem !important;
}

/* Floating date header (sticky at top) */
.dark-theme .TimelineDateHeader--floating {
  background-color: var(--midnight-bg-primary) !important;
  border: 1px solid var(--midnight-divider) !important;
  border-radius: 8px !important;
  padding: 2px 8px !important;
}

.dark-theme .TimelineFloatingHeader {
  z-index: 3 !important;
}

/* ==========================================================================
   Emoji-only & sticker messages
   ========================================================================== */
.dark-theme .module-message__container--emoji,
.dark-theme .module-message__container--sticker-like {
  background: transparent !important;
  padding: 0 !important;
}

/* ==========================================================================
   Reactions — Midnight pills
   ========================================================================== */
.dark-theme .module-message__reactions {
  padding-top: 4px !important;
}

.dark-theme .module-message__reactions--outgoing {
  align-self: flex-start !important;
  padding-inline-start: 0 !important;
  margin-inline-end: 0 !important;
}

.dark-theme .module-message__reactions__reaction {
  background: var(--midnight-reaction-bg) !important;
  border-color: var(--midnight-reaction-bg) !important;
}

.dark-theme .module-message__reactions__reaction--is-me {
  border-color: rgba(88, 101, 242, 0.6) !important;
  background: rgba(88, 101, 242, 0.15) !important;
}

/* ==========================================================================
   Action buttons — Midnight floating toolbar
   ========================================================================== */
.dark-theme .module-message__buttons {
  position: absolute !important;
  right: 14px !important;
  top: -16px !important;
  background: var(--midnight-bg-secondary) !important;
  border-radius: 4px !important;
  padding: 2px 4px !important;
  border: 1px solid var(--midnight-border-subtle) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
  z-index: 2 !important;
}

.dark-theme .module-message__buttons--incoming,
.dark-theme .module-message__buttons--outgoing {
  padding-inline: 4px !important;
  flex-direction: row !important;
}

/* ==========================================================================
   Composition area — Midnight input bar
   ========================================================================== */
.dark-theme .CompositionArea {
  background-color: var(--midnight-bg-primary) !important;
  padding-inline: var(--midnight-gutter) !important;
}

.dark-theme .module-composition-input__input {
  background-color: var(--midnight-input-bg) !important;
  border-radius: 8px !important;
  color: var(--midnight-text-normal) !important;
}

.dark-theme .module-composition-input__input .ql-blank::before {
  color: var(--midnight-text-muted) !important;
}

.dark-theme .CompositionArea__button-cell {
  color: var(--midnight-text-muted) !important;
}

.dark-theme .CompositionArea__attach-file:before {
  background-color: var(--midnight-text-muted) !important;
}

.dark-theme .CompositionArea__send-button::after {
  background-color: var(--midnight-text-normal) !important;
}

/* ==========================================================================
   Quotes / Replies — Midnight-style
   Midnight reply: 14px font, 18px line-height, 4px bottom margin,
   2px spine width, 6px spine border-radius
   ========================================================================== */
.dark-theme .module-quote {
  border-radius: 4px !important;
  font-size: 0.875rem !important;  /* 14px */
}

.dark-theme .module-quote--incoming,
.dark-theme .module-quote--outgoing {
  background-color: rgba(255, 255, 255, 0.06) !important;
}

/* ==========================================================================
   Link previews — Midnight embed style
   ========================================================================== */
.dark-theme .module-message__link-preview {
  background-color: #2b2d31 !important;
  border: 1px solid var(--midnight-border-subtle) !important;
  border-radius: 8px !important;
  overflow: hidden !important;
}

/* ==========================================================================
   Attachments
   ========================================================================== */
.dark-theme .module-message__img-attachment {
  border-radius: 8px !important;
}

.dark-theme .module-message__simple-attachment {
  background-color: var(--midnight-bg-secondary) !important;
  border-radius: 8px !important;
  border: 1px solid var(--midnight-border-subtle) !important;
}

.dark-theme .module-message__simple-attachment__file-name,
.dark-theme .module-message__simple-attachment__file-name--incoming {
  color: var(--midnight-text-link) !important;
}

.dark-theme .module-message__simple-attachment__file-size,
.dark-theme .module-message__simple-attachment__file-size--incoming {
  color: var(--midnight-text-muted) !important;
}

/* ==========================================================================
   Scrollbar — Midnight thin dark
   ========================================================================== */
.dark-theme .ConversationView__timeline::-webkit-scrollbar {
  width: 8px !important;
}
.dark-theme .ConversationView__timeline::-webkit-scrollbar-track {
  background: transparent !important;
}
.dark-theme .ConversationView__timeline::-webkit-scrollbar-thumb {
  background-color: #1a1b1e !important;
  border-radius: 4px !important;
}
.dark-theme .ConversationView__timeline::-webkit-scrollbar-thumb:hover {
  background-color: #4e5058 !important;
}

/* ==========================================================================
   Deleted messages
   ========================================================================== */
.dark-theme .module-message__container--deleted-for-everyone {
  background-color: transparent !important;
  border: none !important;
}
.dark-theme .module-message__text--delete-for-everyone {
  color: var(--midnight-text-muted) !important;
  font-style: italic !important;
}

/* ==========================================================================
   Selection / focus states
   ========================================================================== */
.dark-theme .module-message__wrapper--selected {
  background: rgba(88, 101, 242, 0.08) !important;
}

.dark-theme .module-message:focus-within {
  background: var(--midnight-bg-hover) !important;
}

/* ==========================================================================
   Typing indicator
   ========================================================================== */
.dark-theme .module-message__container-outer--typing-bubble {
  background: transparent !important;
}

/* ==========================================================================
   Error container
   ========================================================================== */
.dark-theme .module-message__error-container {
  min-width: 20px !important;
}

/* ==========================================================================
   Conversation list (left sidebar)
   ========================================================================== */
.dark-theme .module-conversation-list {
  background-color: var(--midnight-bg-secondary) !important;
}

/* ==========================================================================
   Conversation header
   ========================================================================== */
.dark-theme .module-ConversationHeader__button::before {
  background-color: var(--midnight-text-muted) !important;
}
.dark-theme .module-ConversationHeader__button:hover::before {
  background-color: var(--midnight-text-normal) !important;
}

.dark-theme .module-ConversationHeader__header__info__title {
  color: var(--midnight-header-primary) !important;
}
.dark-theme .module-ConversationHeader__header__info__subtitle {
  color: var(--midnight-text-muted) !important;
}

/* ==========================================================================
   System messages
   ========================================================================== */
.dark-theme .SystemMessage {
  color: var(--midnight-text-muted) !important;
}
